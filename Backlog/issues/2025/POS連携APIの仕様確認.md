# POS連携APIの仕様確認

## 基本情報
- 課題キー: APP_MINI-1
- ステータス: 処理中
- 優先度: 高
- 担当者: CM_高垣龍平
- 作成日時: 2025/11/12 10:00:00
- 更新日時: 2025/12/10 14:30:00
- [Backlog Issue Link](https://example.backlog.jp/view/APP_MINI-1)

## 詳細
@POS_山田様 @FM_田中様
POS様システムとの連携に必要なAPI仕様の確認・調整をさせていただきたく存じます。

## 背景
LINEミニアプリからPOSサーバーへ会員情報の連携、およびポイント残高の取得を行う必要があります。
IF仕様書の作成にあたり、以下の点についてご確認をお願いいたします。

## 確認事項

### 1. 仮会員登録API
- エンドポイント: `POST /members/temporary`（想定）
- リクエスト: 会員情報（氏名、住所等）
- レスポンス: 仮会員ID、QRコード

**質問**: QRコードはBase64エンコードで返却いただく形でよろしいでしょうか？

### 2. ポイント残高取得API
- エンドポイント: `GET /members/{memberId}/points`（想定）
- リアルタイム性: 画面表示時に毎回取得

**質問**: キャッシュの有効期間などはありますでしょうか？

### 3. Webhook（ポイント更新通知）
- POSシステムでポイントが更新された際の通知

**質問**: 認証方式はHMAC署名でよろしいでしょうか？

### 4. エラーコード体系
- 共通のエラーコード体系を定義したい

ご確認のほどよろしくお願いいたします。

## コメント

### コメント 1
- **投稿者**: POS_山田様
- **日時**: 2025/11/15 11:00:00

@CM_高垣龍平

ご連絡ありがとうございます。
以下、回答いたします。

### 1. 仮会員登録API
QRコードはBase64エンコードで返却いたします。
フォーマットは`data:image/png;base64,xxxxx`の形式です。

### 2. ポイント残高取得API
キャッシュは設けておりません。毎回最新値を返却します。
ただし、大量アクセス時のレートリミットとして、1分間に60リクエストまでとさせてください。

### 3. Webhook
HMAC-SHA256での署名検証で問題ございません。
シークレットキーは別途セキュアな方法でお渡しします。

### 4. エラーコード
弊社の既存エラーコード体系がありますので、資料をお送りします。

---

### コメント 2
- **投稿者**: CM_高垣龍平
- **日時**: 2025/11/19 14:00:00

@POS_山田様
ご回答ありがとうございます！

レートリミット60req/minで承知いたしました。
フロントエンド側でも適切に制御いたします。

エラーコード体系の資料、お待ちしております。

---

### コメント 3
- **投稿者**: POS_山田様
- **日時**: 2025/11/22 10:30:00

@CM_高垣龍平

エラーコード体系の資料を添付いたします。

[添付ファイル: POS_API_ErrorCodes_v1.0.xlsx]

また、API仕様書のドラフト版も添付いたします。
内容ご確認いただき、フィードバックをお願いいたします。

[添付ファイル: POS_API_Specification_draft_v0.9.pdf]

---

### コメント 4
- **投稿者**: CM_高垣龍平
- **日時**: 2025/12/10 14:30:00

@POS_山田様
資料ありがとうございます！確認いたしました。

API仕様書について、いくつか確認事項がございます。

1. **タイムアウト設定**: 仮会員登録APIのタイムアウトは何秒を想定されていますか？弊社側では5秒、リトライ3回を想定しています。

2. **テスト環境**: 結合テスト用のサンドボックス環境はご用意いただけますでしょうか？

3. **認証情報**: API認証用のクレデンシャル（APIキー等）の発行スケジュールを教えてください。

**ご確認・ご回答お待ちしております🙏**
