# 【11/19】要件定義 第2回 議事録

## 会議情報
- **日時**: 2025年11月19日（火）14:00-15:30
- **議題**: POS連携API仕様確認、画面遷移の整理
- **参加者**: FM様（田中様、佐藤様）、POS様（山田様、鈴木様）、サンプル株式会社（高橋、鈴木）

## サマリー
POS様よりAPI仕様書ドラフトが共有され、連携方式の詳細を確認。ポイント取得はリアルタイムAPI、会員アクティベートは非同期（Webhook）方式で実装することが決定。画面遷移図のドラフトを確認し、フィードバックを反映予定。

## 決定事項まとめ
- **ポイント取得**: リアルタイムAPI（GET /members/{memberId}/points）
- **会員アクティベート**: 非同期Webhook方式（POS様→LINEミニアプリ）
- **店舗マスタ連携**: CSVファイルをS3経由で日次取り込み
- **エラーハンドリング**: POS様APIタイムアウトは5秒、リトライは3回まで

## TODOアイテム
- [ ] API仕様書の最終版作成（POS様、11/26まで）
- [ ] 画面遷移図へのフィードバック反映（サンプル株式会社、11/26まで）
- [ ] 店舗マスタCSVフォーマットの確定（FM様、11/26まで）
- [ ] インフラ構成図の作成（サンプル株式会社、11/26まで）

## 議題と討議内容

### 1. POS連携API仕様の確認

**討議内容**:
- POS様より以下のAPIが提供されることを確認しました:
  - `POST /members/temporary` - 仮会員登録
  - `GET /members/{memberId}` - 会員情報取得
  - `GET /members/{memberId}/points` - ポイント残高取得
  - `POST /members/{memberId}/activate` - 本会員アクティベート（店舗側操作）
- アクティベート完了時はWebhookでLINEミニアプリ側に通知される仕様を確認しました。
- Webhook受信後にDBのステータスを更新し、ユーザーにはLINE通知を送信する流れとします。

### 2. 連携方式の詳細確認

**討議内容**:
- ポイント取得はリアルタイム性が求められるため、同期APIで実装します。
- 会員アクティベートは店舗スタッフの操作後にPOS様システムで処理されるため、非同期Webhook方式が適切との結論に至りました。
- APIタイムアウトは5秒、リトライは最大3回とし、それでも失敗した場合はエラー画面を表示する方針です。

### 3. 店舗マスタ連携の方式

**討議内容**:
- FM様より、店舗情報は本社で一元管理しており、日次でCSVファイルを出力可能との情報が共有されました。
- CSVファイルをS3にアップロードし、Lambda経由でDynamoDBに取り込む方式を採用します。
- 店舗の追加・変更・削除はCSVで管理し、リアルタイム更新は不要との確認が取れました。

### 4. 画面遷移図の確認

**討議内容**:
- サンプル株式会社より画面遷移図のドラフトを共有し、以下のフィードバックがありました:
  - トップ画面から店舗一覧への導線を追加してほしい
  - ポイント確認画面に「ポイント履歴」ボタンを追加（第二フェーズ）
  - 退会確認画面の文言を検討してほしい
- フィードバックを反映した修正版を次回までに作成予定です。

## 備考・補足事項
- 次回は11/26（火）に要件定義の第3回を実施予定
- Figmaでのデザイン作成を並行して開始
